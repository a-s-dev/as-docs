<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `Store` trait in crate `sync15`."><meta name="keywords" content="rust, rustlang, rust-lang, Store"><title>sync15::sync::Store - Rust</title><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../dark.css"><link rel="stylesheet" type="text/css" href="../../light.css" id="themeStyle"><script src="../../storage.js"></script><noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="shortcut icon" href="../../favicon.ico"><style type="text/css">#crate-search{background-image:url("../../down-arrow.svg");}</style></head><body class="rustdoc trait"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu">&#9776;</div><a href='../../sync15/index.html'><div class='logo-container'><img src='../../rust-logo.png' alt='logo'></div></a><p class='location'>Trait Store</p><div class="sidebar-elems"><div class="block items"><a class="sidebar-title" href="#required-methods">Required Methods</a><div class="sidebar-links"><a href="#tymethod.apply_incoming">apply_incoming</a><a href="#tymethod.collection_name">collection_name</a><a href="#tymethod.get_collection_requests">get_collection_requests</a><a href="#tymethod.get_sync_assoc">get_sync_assoc</a><a href="#tymethod.reset">reset</a><a href="#tymethod.sync_finished">sync_finished</a><a href="#tymethod.wipe">wipe</a></div><a class="sidebar-title" href="#provided-methods">Provided Methods</a><div class="sidebar-links"><a href="#method.prepare_for_sync">prepare_for_sync</a></div><a class="sidebar-title" href="#implementors">Implementors</a></div><p class='location'><a href='../index.html'>sync15</a>::<wbr><a href='index.html'>sync</a></p><script>window.sidebarCurrent = {name: 'Store', ty: 'trait', relpath: ''};</script><script defer src="sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!"><img src="../../brush.svg" width="18" alt="Pick another theme!"></button><div id="theme-choices"></div></div><script src="../../theme.js"></script><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><a id="settings-menu" href="../../settings.html"><img src="../../wheel.svg" width="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class='fqn'><span class='out-of-band'><span id='render-detail'><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class='inner'>&#x2212;</span>]</a></span><a class='srclink' href='../../src/sync15_traits/store.rs.html#31-97' title='goto source code'>[src]</a></span><span class='in-band'>Trait <a href='../index.html'>sync15</a>::<wbr><a href='index.html'>sync</a>::<wbr><a class="trait" href=''>Store</a></span></h1><div class="docblock type-decl hidden-by-usual-hider"><pre class='rust trait'>pub trait Store {
    fn <a href='#tymethod.collection_name' class='fnname'>collection_name</a>(&amp;self) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/alloc/borrow/enum.Cow.html" title="enum alloc::borrow::Cow">Cow</a>&lt;'static, <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.str.html">str</a>&gt;;
<div class='item-spacer'></div>    fn <a href='#tymethod.apply_incoming' class='fnname'>apply_incoming</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;self, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inbound: <a class="struct" href="https://doc.rust-lang.org/nightly/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="struct" href="../../sync15/changeset/struct.RecordChangeset.html" title="struct sync15::changeset::RecordChangeset">RecordChangeset</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.tuple.html">(</a><a class="struct" href="../../sync15/bso_record/struct.Payload.html" title="struct sync15::bso_record::Payload">Payload</a>, <a class="struct" href="../../sync15/util/struct.ServerTimestamp.html" title="struct sync15::util::ServerTimestamp">ServerTimestamp</a><a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.tuple.html">)</a>&gt;&gt;, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;telem: &amp;mut <a class="struct" href="../../sync15/telemetry/struct.Engine.html" title="struct sync15::telemetry::Engine">Engine</a><br>&nbsp;&nbsp;&nbsp;&nbsp;) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="../../sync15/changeset/struct.RecordChangeset.html" title="struct sync15::changeset::RecordChangeset">RecordChangeset</a>&lt;<a class="struct" href="../../sync15/bso_record/struct.Payload.html" title="struct sync15::bso_record::Payload">Payload</a>&gt;, <a class="struct" href="https://docs.rs/anyhow/1.0.32/anyhow/struct.Error.html" title="struct anyhow::Error">Error</a>&gt;;
<div class='item-spacer'></div>    fn <a href='#tymethod.sync_finished' class='fnname'>sync_finished</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;self, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new_timestamp: <a class="struct" href="../../sync15/util/struct.ServerTimestamp.html" title="struct sync15::util::ServerTimestamp">ServerTimestamp</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;records_synced: <a class="struct" href="https://doc.rust-lang.org/nightly/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="struct" href="../../sync_guid/struct.Guid.html" title="struct sync_guid::Guid">Guid</a>&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, <a class="struct" href="https://docs.rs/anyhow/1.0.32/anyhow/struct.Error.html" title="struct anyhow::Error">Error</a>&gt;;
<div class='item-spacer'></div>    fn <a href='#tymethod.get_collection_requests' class='fnname'>get_collection_requests</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;self, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;server_timestamp: <a class="struct" href="../../sync15/util/struct.ServerTimestamp.html" title="struct sync15::util::ServerTimestamp">ServerTimestamp</a><br>&nbsp;&nbsp;&nbsp;&nbsp;) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="https://doc.rust-lang.org/nightly/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="struct" href="../../sync15/request/struct.CollectionRequest.html" title="struct sync15::request::CollectionRequest">CollectionRequest</a>&gt;, <a class="struct" href="https://docs.rs/anyhow/1.0.32/anyhow/struct.Error.html" title="struct anyhow::Error">Error</a>&gt;;
<div class='item-spacer'></div>    fn <a href='#tymethod.get_sync_assoc' class='fnname'>get_sync_assoc</a>(&amp;self) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="enum" href="../../sync15/coll_state/enum.StoreSyncAssociation.html" title="enum sync15::coll_state::StoreSyncAssociation">StoreSyncAssociation</a>, <a class="struct" href="https://docs.rs/anyhow/1.0.32/anyhow/struct.Error.html" title="struct anyhow::Error">Error</a>&gt;;
<div class='item-spacer'></div>    fn <a href='#tymethod.reset' class='fnname'>reset</a>(&amp;self, assoc: &amp;<a class="enum" href="../../sync15/coll_state/enum.StoreSyncAssociation.html" title="enum sync15::coll_state::StoreSyncAssociation">StoreSyncAssociation</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, <a class="struct" href="https://docs.rs/anyhow/1.0.32/anyhow/struct.Error.html" title="struct anyhow::Error">Error</a>&gt;;
<div class='item-spacer'></div>    fn <a href='#tymethod.wipe' class='fnname'>wipe</a>(&amp;self) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, <a class="struct" href="https://docs.rs/anyhow/1.0.32/anyhow/struct.Error.html" title="struct anyhow::Error">Error</a>&gt;;

    fn <a href='#method.prepare_for_sync' class='fnname'>prepare_for_sync</a>(&amp;self, _get_client_data: &amp;dyn <a class="trait" href="https://doc.rust-lang.org/nightly/core/ops/function/trait.Fn.html" title="trait core::ops::function::Fn">Fn</a>()) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, <a class="struct" href="https://docs.rs/anyhow/1.0.32/anyhow/struct.Error.html" title="struct anyhow::Error">Error</a>&gt; { ... }
}</pre></div><div class='docblock'><p>Low-level store functionality. Stores that need custom reconciliation logic
should use this.</p>
<p>Different stores will produce errors of different types.  To accommodate
this, we force them all to return failure::Error.</p>
</div>
            <h2 id='required-methods' class='small-section-header'>Required methods<a href='#required-methods' class='anchor'></a></h2><div class='methods'><h3 id='tymethod.collection_name' class='method'><code id='collection_name.v'>fn <a href='#tymethod.collection_name' class='fnname'>collection_name</a>(&amp;self) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/alloc/borrow/enum.Cow.html" title="enum alloc::borrow::Cow">Cow</a>&lt;'static, <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.str.html">str</a>&gt;</code></h3><h3 id='tymethod.apply_incoming' class='method'><code id='apply_incoming.v'>fn <a href='#tymethod.apply_incoming' class='fnname'>apply_incoming</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&amp;self, <br>&nbsp;&nbsp;&nbsp;&nbsp;inbound: <a class="struct" href="https://doc.rust-lang.org/nightly/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="struct" href="../../sync15/changeset/struct.RecordChangeset.html" title="struct sync15::changeset::RecordChangeset">RecordChangeset</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.tuple.html">(</a><a class="struct" href="../../sync15/bso_record/struct.Payload.html" title="struct sync15::bso_record::Payload">Payload</a>, <a class="struct" href="../../sync15/util/struct.ServerTimestamp.html" title="struct sync15::util::ServerTimestamp">ServerTimestamp</a><a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.tuple.html">)</a>&gt;&gt;, <br>&nbsp;&nbsp;&nbsp;&nbsp;telem: &amp;mut <a class="struct" href="../../sync15/telemetry/struct.Engine.html" title="struct sync15::telemetry::Engine">Engine</a><br>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="../../sync15/changeset/struct.RecordChangeset.html" title="struct sync15::changeset::RecordChangeset">RecordChangeset</a>&lt;<a class="struct" href="../../sync15/bso_record/struct.Payload.html" title="struct sync15::bso_record::Payload">Payload</a>&gt;, <a class="struct" href="https://docs.rs/anyhow/1.0.32/anyhow/struct.Error.html" title="struct anyhow::Error">Error</a>&gt;</code></h3><div class='docblock'><p><code>inbound</code> is a vector to support the case where
<code>get_collection_requests</code> returned multiple requests. The changesets are
in the same order as the requests were -- e.g. if <code>vec![req_a, req_b]</code>
was returned from <code>get_collection_requests</code>, <code>inbound</code> will have the
results from <code>req_a</code> as its first index, and those from <code>req_b</code> as it's
second.</p>
</div><h3 id='tymethod.sync_finished' class='method'><code id='sync_finished.v'>fn <a href='#tymethod.sync_finished' class='fnname'>sync_finished</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&amp;self, <br>&nbsp;&nbsp;&nbsp;&nbsp;new_timestamp: <a class="struct" href="../../sync15/util/struct.ServerTimestamp.html" title="struct sync15::util::ServerTimestamp">ServerTimestamp</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;records_synced: <a class="struct" href="https://doc.rust-lang.org/nightly/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="struct" href="../../sync_guid/struct.Guid.html" title="struct sync_guid::Guid">Guid</a>&gt;<br>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, <a class="struct" href="https://docs.rs/anyhow/1.0.32/anyhow/struct.Error.html" title="struct anyhow::Error">Error</a>&gt;</code></h3><h3 id='tymethod.get_collection_requests' class='method'><code id='get_collection_requests.v'>fn <a href='#tymethod.get_collection_requests' class='fnname'>get_collection_requests</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&amp;self, <br>&nbsp;&nbsp;&nbsp;&nbsp;server_timestamp: <a class="struct" href="../../sync15/util/struct.ServerTimestamp.html" title="struct sync15::util::ServerTimestamp">ServerTimestamp</a><br>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="https://doc.rust-lang.org/nightly/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="struct" href="../../sync15/request/struct.CollectionRequest.html" title="struct sync15::request::CollectionRequest">CollectionRequest</a>&gt;, <a class="struct" href="https://docs.rs/anyhow/1.0.32/anyhow/struct.Error.html" title="struct anyhow::Error">Error</a>&gt;</code></h3><div class='docblock'><p>The store is responsible for building the collection request. Engines
typically will store a lastModified timestamp and use that to build a
request saying &quot;give me full records since that date&quot; - however, other
engines might do something fancier. This could even later be extended to
handle &quot;backfills&quot; etc</p>
<p>To support more advanced use cases (e.g. remerge), multiple requests can
be returned here. The vast majority of engines will just want to return
zero or one item in their vector (zero is a valid optimization when the
server timestamp is the same as the engine last saw, one when it is not)</p>
<p>Important: In the case when more than one collection is requested, it's
assumed the last one is the &quot;canonical&quot; one. (That is, it must be for
&quot;this&quot; collection, its timestamp is used to represent the sync, etc).</p>
</div><h3 id='tymethod.get_sync_assoc' class='method'><code id='get_sync_assoc.v'>fn <a href='#tymethod.get_sync_assoc' class='fnname'>get_sync_assoc</a>(&amp;self) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="enum" href="../../sync15/coll_state/enum.StoreSyncAssociation.html" title="enum sync15::coll_state::StoreSyncAssociation">StoreSyncAssociation</a>, <a class="struct" href="https://docs.rs/anyhow/1.0.32/anyhow/struct.Error.html" title="struct anyhow::Error">Error</a>&gt;</code></h3><div class='docblock'><p>Get persisted sync IDs. If they don't match the global state we'll be
<code>reset()</code> with the new IDs.</p>
</div><h3 id='tymethod.reset' class='method'><code id='reset.v'>fn <a href='#tymethod.reset' class='fnname'>reset</a>(&amp;self, assoc: &amp;<a class="enum" href="../../sync15/coll_state/enum.StoreSyncAssociation.html" title="enum sync15::coll_state::StoreSyncAssociation">StoreSyncAssociation</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, <a class="struct" href="https://docs.rs/anyhow/1.0.32/anyhow/struct.Error.html" title="struct anyhow::Error">Error</a>&gt;</code></h3><div class='docblock'><p>Reset the store without wiping local data, ready for a &quot;first sync&quot;.
<code>assoc</code> defines how this store is to be associated with sync.</p>
</div><h3 id='tymethod.wipe' class='method'><code id='wipe.v'>fn <a href='#tymethod.wipe' class='fnname'>wipe</a>(&amp;self) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, <a class="struct" href="https://docs.rs/anyhow/1.0.32/anyhow/struct.Error.html" title="struct anyhow::Error">Error</a>&gt;</code></h3></div><span class='loading-content'>Loading content...</span>
            <h2 id='provided-methods' class='small-section-header'>Provided methods<a href='#provided-methods' class='anchor'></a></h2><div class='methods'><h3 id='method.prepare_for_sync' class='method'><code id='prepare_for_sync.v'>fn <a href='#method.prepare_for_sync' class='fnname'>prepare_for_sync</a>(&amp;self, _get_client_data: &amp;dyn <a class="trait" href="https://doc.rust-lang.org/nightly/core/ops/function/trait.Fn.html" title="trait core::ops::function::Fn">Fn</a>()) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, <a class="struct" href="https://docs.rs/anyhow/1.0.32/anyhow/struct.Error.html" title="struct anyhow::Error">Error</a>&gt;</code></h3><div class='docblock'><p>Prepares the store for syncing. The tabs store currently uses this to
store the current list of clients, which it uses to look up device names
and types.</p>
<p>Note that this method is only called by <code>sync_multiple</code>, and only if a
command processor is registered. In particular, <code>prepare_for_sync</code> will
not be called if the store is synced using <code>sync::synchronize</code> or
<code>sync_multiple::sync_multiple</code>. It <em>will</em> be called if the store is
synced via the Sync Manager.</p>
<p>TODO(issue #2590): This is pretty cludgey and will be hard to extend for
any case other than the tabs case. We should find another way to support
tabs...</p>
</div></div><span class='loading-content'>Loading content...</span>
            <h2 id='implementors' class='small-section-header'>Implementors<a href='#implementors' class='anchor'></a></h2><div class='item-list' id='implementors-list'></div><span class='loading-content'>Loading content...</span><script type="text/javascript" src="../../implementors/sync15_traits/store/trait.Store.js" async></script></section><section id="search" class="content hidden"></section><section class="footer"></section><script>window.rootPath = "../../";window.currentCrate = "sync15";</script><script src="../../main.js"></script><script defer src="../../search-index.js"></script></body></html>